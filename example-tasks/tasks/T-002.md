# T-002

  - steps:
      - [ ] Identify different POS types and their coupon structures
      - [ ] Map PIX coupon variations by POS type
      - [ ] Map credit card coupon variations by POS type
      - [ ] Update extraction script to detect coupon type
      - [ ] Implement specific parsers for each coupon type
      - [ ] Add coupon type field in extracted transactions
      - [ ] Test extraction with different coupon types
      - [ ] Document supported coupon types
    ```md
    Implement extraction of coupon data considering different POS types.
    
    The current system extracts coupons generically, but there are different
    POS types that generate coupons with different structures, especially for:
    
    - **PIX**: Different coupon formats for PIX depending on POS type
    - **Credit Card**: Different credit card coupon formats depending on POS type
    
    It is necessary to:
    1. Identify and catalog the different POS types used
    2. Map the differences in coupon structure for each type
    3. Adapt the extraction script (`extract_emsys.py`) to detect and process
    each coupon type correctly
    4. Ensure extracted data maintains consistency regardless of
    coupon/POS type
    5. Add metadata about coupon type in extracted transactions to
    facilitate traceability and debugging
    
    Related files:
    - `scripts/extract_emsys.py` - Main extraction script
    - `supabase/consulta-cupons-com-pix.sql` - Coupon SQL query
    - `scripts/db_utils.py` - Database utilities
    ```