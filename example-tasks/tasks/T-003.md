# T-003

  - steps:
      - [x] Extract PIX coupon codes from image (`temp/scancaixa/2/paginas_extraidas/cupom-pix.png`)
      - [ ] Identify all relevant codes (DOC, ID, POS, COD. EC, etc.)
      - [x] Query Banco do Brasil transactions from Nova Olinda station
      - [ ] Manually validate PIX coupon codes in Banco do Brasil transactions
      - [ ] Generate validation report with found/not found codes
      - [ ] Document which BB fields correspond to coupon codes
      - [x] Validate Emsys matching (deposits) ↔ Supabase (transactions) via `seq_deposito_pagto` (temp/BB-Rodovia-16-12-2025)
      - [x] Include orphan PIX deposits (manually entered without coupon) in Emsys extraction (`UNION ALL` in `emsys_extraction_source.py`)
    ```md
    (Moved from Backlog to Doing on 2025-12-19)
    
    Validate if the codes present in the PIX coupon exist in Banco do Brasil transactions
    from Nova Olinda station.
    
    Note (2025-12-19):
    - Emsys↔Supabase matching (PIX) validated using `seq_deposito_pagto`:
    `temp/BB-Rodovia-16-12-2025/transactions_rows (1).csv` vs
    `temp/BB-Rodovia-16-12-2025/Emsys_tab_deposito_pagto_cupom_202512181651.csv`.
    - Orphan manual deposit (e.g., `seq_deposito_pagto=546774`, `seq_cupom=0`) is now extracted as PIX transaction
    with `reference=DEPOSITO_ORFAO_{seq_deposito_pagto}_PDV_{cod_pdv}` and `cupom_num=NULL`.
    - Luiz mentioned that values come different because of the fee already charged by the bank.
    - Verified that there are transactions that arrive grouped at Banco do Brasil for that coupon's day.
    ```