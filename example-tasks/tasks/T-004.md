# T-004

  - steps:
      - [x] Review how dates/times are extracted and stored in the backend
      - [x] Ensure all extracted times are converted to UTC before saving to database
      - [x] Update `time_utc` field to always contain complete datetime in UTC
      - [x] Standardize time extraction from `detail` field (BB API) to convert to UTC
      - [x] Simplify formatting functions in frontend removing timezone conditionals
      - [x] Update `formatDateBR` to always assume UTC and convert to BR
      - [x] Remove `formatDateBRLocal` function after standardization
      - [x] Fix coupon router to calculate datetime_utc from date + time
      - [x] Update scripts/db_utils.py to use datetime_utc and require this field
      - [x] Remove unnecessary fallbacks from frontend (assumes datetime_utc always present)
      
    ```md
    Completed (2025-12-23):
    
    **Complete standardization:**
    - All sources (BB API, Emsys, Coupons) now generate `datetime_utc` correctly
    - Coupon router calculates `datetime_utc` from `date` + `time` with BR â†’ UTC conversion
    - Old scripts (`scripts/db_utils.py`) updated to use `datetime_utc` and require this field
    - Code no longer accepts transactions without `datetime_utc` (skips with warning)
    
    **Simplified frontend:**
    - Removed all conditional fallbacks for `datetime_utc`
    - Transaction filters use only `datetime_utc`
    - `getTransactionTimestamp` function simplified (only `datetime_utc`)
    - Time filters extract directly from `datetime_utc` converting to BR timezone
    - Date/time formatting uses only `datetime_utc` (no fallback to `date` + `time`)
    
    **Modified files:**
    - `backend/app/routers/cupons.py` - Calculates `datetime_utc` for coupon transactions
    - `scripts/db_utils.py` - Uses `datetime_utc` and requires this mandatory field
    - `web/src/pages/reconciliations/ReconciliationDetail.tsx` - Removed unnecessary fallbacks
    
    **Result:**
    - Standardized system: all transactions have mandatory `datetime_utc`
    - Simpler code without unnecessary conditionals
    - Better performance: no fallback checks
    - Warnings in console if any transaction without `datetime_utc` appears (unexpected case)
    ```