# T-006

    ```md
    Implement transaction sorting by time proximity in the database
    instead of doing it in JavaScript on the frontend.
    
    **Problem:**
    - Sorting was being done in JavaScript after fetching all transactions
    - Heavy processing on the client, especially with many transactions
    - Did not take advantage of database indexes
    
    **Implemented solution:**
    1. **SQL Function**: Created `get_transactions_by_time_proximity()` that:
       - Receives datetime_utc reference from the group
       - Calculates absolute difference in seconds for each transaction
       - Sorts by proximity (closest first)
       - Filters only transactions with non-null datetime_utc
       - Supports exclusion of transactions already in the group
       - Supports filtering by datetime_utc interval
    
    2. **Simplified frontend**: 
       - Uses `supabase.rpc()` to call the SQL function
       - Removes all sorting logic from `useMemo`
       - Keeps only value and time filters on the client
    
    **Created files:**
    - `supabase/migrations/20251223131137_add_get_transactions_by_time_proximity.sql` - SQL function
    
    **Modified files:**
    - `web/src/pages/reconciliations/ReconciliationDetail.tsx` - Uses SQL function instead of sorting in JS
    
    **Advantages:**
    - Performance: Sorting in PostgreSQL (optimized)
    - Scalability: Works well with many records
    - Less data transferred: Sorts before sending
    - Uses database indexes on datetime_utc
    - Simpler code: No fallbacks, only datetime_utc
    ```